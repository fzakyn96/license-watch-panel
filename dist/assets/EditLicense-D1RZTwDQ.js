import{M as T,J as P,u as A,j as I,r as u,a as e,l as j,v,C as B,x as K,L as O}from"./index-B5yO14EG.js";import{B as o}from"./button-BLyQRZSy.js";import{I as d}from"./input-Q8JswDB5.js";import{P as N,a as w,C as b,f as y,b as k,c as _,T as $}from"./popover-0aX1YvkH.js";import{L as i}from"./label-gZ4NEqCJ.js";import{b as H}from"./index-Doupoh4T.js";import{C as q}from"./circle-check-D8B2VLFM.js";const Q=()=>{const{uuid:x}=T(),m=P(),{toast:h}=A(),{theme:f}=I(),[C,S]=u.useState(!0),[s,g]=u.useState(null),[t,E]=u.useState({});u.useEffect(()=>{x&&(async()=>{try{const r=await(await v(`https://digio.pgn.co.id/lisa_backend/licenses/find?uuid=${x}`)).json();if(r.status===200&&r.data){const{history_licenses:c,...p}=r.data;g(p)}else throw new Error("Gagal memuat data lisensi")}catch{h({title:"Error",description:"Terjadi kesalahan saat memuat data lisensi",variant:"destructive"}),m("/")}finally{S(!1)}})()},[x]);const M=()=>{const a={};return["name","start_date","end_date","volume","satuan","harga_satuan","username","password"].forEach(r=>{s!=null&&s[r]||(a[r]="Field ini wajib diisi")}),s!=null&&s.volume&&s.volume<=0&&(a.volume="Volume harus lebih besar dari 0"),s!=null&&s.harga_satuan&&s.harga_satuan<0&&(a.harga_satuan="Harga satuan tidak boleh negatif"),E(a),Object.keys(a).length===0},l=(a,n)=>{if(!s)return;const r={...s,[a]:n};if(a==="volume"||a==="harga_satuan"){const c=a==="volume"?Number(n):s.volume,p=a==="harga_satuan"?Number(n):s.harga_satuan;r.jumlah=c*p}g(r)},F=a=>{const n=new Date,r=new Date(a),c=Math.ceil((r.getTime()-n.getTime())/(1e3*60*60*24));return c<0?{text:"Sudah Kadaluarsa",color:"bg-red-100 text-red-700 border-red-200",icon:B}:c<=120?{text:"Akan Kadaluarsa",color:"bg-yellow-100 text-yellow-700 border-yellow-200",icon:K}:{text:"Aman",color:"bg-green-100 text-green-700 border-green-200",icon:q}},L=async a=>{if(a.preventDefault(),!!M())try{const n=O("username")||"",r={...s,last_user_input:n,updatedAt:new Date().toISOString()};if((await v("https://digio.pgn.co.id/lisa_backend/licenses/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)h({title:"Berhasil",description:"Data lisensi berhasil diperbarui",variant:"success"}),m("/");else throw new Error("Gagal memperbarui data")}catch{h({title:"Error",description:"Terjadi kesalahan saat memperbarui data lisensi",variant:"destructive"})}};return C?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Memuat..."}):e.jsxs("div",{children:[e.jsx("header",{className:"bg-card border-b border-border shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("img",{src:f==="dark"?"/lisa/logo-dark.png":"/lisa/logo-white.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain"}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Lisensi Aset"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Sistem Monitoring Lisensi Aset"})]})]}),e.jsxs(o,{variant:"default",onClick:()=>m("/"),className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:"Kembali"})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:e.jsx("div",{className:"space-y-6 sm:space-y-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"Edit Lisensi"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Edit data lisensi yang sudah ada"})]}),(s==null?void 0:s.end_date)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),(()=>{const a=F(s.end_date),n=a.icon;return e.jsxs("div",{className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium border ${a.color}`,children:[e.jsx(n,{className:"w-4 h-4 mr-1.5"}),a.text]})})()]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8",children:e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsx("div",{className:"bg-card p-4 sm:p-6 rounded-lg border border-border",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(i,{htmlFor:"name",children:"Nama Aset"}),e.jsx(d,{id:"name",value:(s==null?void 0:s.name)||"",onChange:a=>l("name",a.target.value),"aria-invalid":!!t.name,className:"mt-1",placeholder:"Masukkan nama aset"}),t.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.name})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Tanggal Mulai"}),e.jsxs(N,{children:[e.jsx(w,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:j("w-full justify-start text-left font-normal mt-1",!(s!=null&&s.start_date)&&"text-muted-foreground"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),s!=null&&s.start_date?y(new Date(s.start_date),"yyyy-MM-dd"):e.jsx("span",{children:"Pilih tanggal"})]})}),e.jsx(k,{className:"w-auto p-0",children:e.jsx(_,{mode:"single",selected:s!=null&&s.start_date?new Date(s.start_date):void 0,onSelect:a=>{l("start_date",(a==null?void 0:a.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.start_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.start_date})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Tanggal Berakhir"}),e.jsxs(N,{children:[e.jsx(w,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:j("w-full justify-start text-left font-normal mt-1",!(s!=null&&s.end_date)&&"text-muted-foreground"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),s!=null&&s.end_date?y(new Date(s.end_date),"yyyy-MM-dd"):e.jsx("span",{children:"Pilih tanggal"})]})}),e.jsx(k,{className:"w-auto p-0",children:e.jsx(_,{mode:"single",selected:s!=null&&s.end_date?new Date(s.end_date):void 0,onSelect:a=>{l("end_date",(a==null?void 0:a.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.end_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.end_date})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"volume",children:"Volume"}),e.jsx(d,{id:"volume",type:"number",value:(s==null?void 0:s.volume)||"",onChange:a=>l("volume",Number(a.target.value)),"aria-invalid":!!t.volume,className:"mt-1",placeholder:"Masukkan volume"}),t.volume&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.volume})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"satuan",children:"Satuan"}),e.jsx(d,{id:"satuan",value:(s==null?void 0:s.satuan)||"",onChange:a=>l("satuan",a.target.value),"aria-invalid":!!t.satuan,className:"mt-1",placeholder:"Masukkan satuan"}),t.satuan&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.satuan})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"harga_satuan",children:"Harga Satuan"}),e.jsx(d,{id:"harga_satuan",type:"number",value:(s==null?void 0:s.harga_satuan)||"",onChange:a=>l("harga_satuan",Number(a.target.value)),"aria-invalid":!!t.harga_satuan,className:"mt-1",placeholder:"Masukkan harga satuan"}),t.harga_satuan&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.harga_satuan})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"jumlah",children:"Total Harga"}),e.jsx(d,{id:"jumlah",type:"number",value:(s==null?void 0:s.jumlah)||0,disabled:!0,className:"mt-1 bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"username",children:"Username"}),e.jsx(d,{id:"username",value:(s==null?void 0:s.username)||"",onChange:a=>l("username",a.target.value),"aria-invalid":!!t.username,className:"mt-1",placeholder:"Masukkan username"}),t.username&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.username})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Password"}),e.jsx(d,{id:"password",type:"password",value:(s==null?void 0:s.password)||"",onChange:a=>l("password",a.target.value),"aria-invalid":!!t.password,className:"mt-1",placeholder:"Masukkan password"}),t.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.password})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"lokasi_lisensi",children:"Lokasi"}),e.jsx(d,{id:"lokasi_lisensi",value:(s==null?void 0:s.lokasi_lisensi)||"",onChange:a=>l("lokasi_lisensi",a.target.value),className:"mt-1",placeholder:"Masukkan lokasi"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"description",children:"Catatan"}),e.jsx($,{id:"description",value:(s==null?void 0:s.description)||"",onChange:a=>l("description",a.target.value),className:"mt-1",rows:4,placeholder:"Masukkan catatan atau keterangan tambahan..."})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:[e.jsx(o,{type:"button",variant:"destructive",onClick:()=>m("/"),className:"w-full sm:w-auto order-2 sm:order-1",children:"Batal"}),e.jsx(o,{type:"submit",className:"w-full sm:w-auto order-1 sm:order-2",children:"Simpan"})]})]})})]})};export{Q as EditLicense};
