import{I as F,u as E,r as x,a,l as p,K as L,o as D}from"./index-GOYY8giK.js";import{B as u}from"./button-BJ681dZX.js";import{I as c}from"./input-Cr0sMyyQ.js";import{P as g,a as j,C as v,f as N,b as _,c as b,T as M}from"./popover-Daurewjp.js";import{L as r}from"./label-BubnTDZT.js";import{b as T}from"./index-8uEgd1Yh.js";const P={name:"",start_date:"",end_date:"",volume:"",satuan:"",harga_satuan:"",jumlah:0,username:"",password:"",lokasi_lisensi:"",description:"",last_user_input:""},R=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),O=n=>{const o=n.replace(/\D/g,"");return o?`Rp. ${new Intl.NumberFormat("id-ID").format(parseInt(o))}`:""},A=n=>{const o=n.replace(/Rp\.\s?/g,"").replace(/\./g,"");return parseInt(o)||0},J=()=>{const n=F(),{toast:o}=E(),[e,f]=x.useState(P),[t,k]=x.useState({}),[w,y]=x.useState(""),S=()=>{const s={};return["name","start_date","end_date","volume","satuan","harga_satuan","username","password"].forEach(d=>{e[d]||(s[d]="Field ini wajib diisi")}),e.volume&&e.volume<=0&&(s.volume="Volume harus lebih besar dari 0"),e.harga_satuan&&e.harga_satuan<0&&(s.harga_satuan="Harga satuan tidak boleh negatif"),k(s),Object.keys(s).length===0},i=(s,l)=>{const d={...e,[s]:l};if(s==="volume"||s==="harga_satuan"){const m=s==="volume"?Number(l):Number(e.volume)||0,h=s==="harga_satuan"?Number(l):Number(e.harga_satuan)||0;d.jumlah=m*h}f(d)},C=s=>{const l=O(s);y(l);const d=A(l);i("harga_satuan",d)},I=async s=>{var l,d;if(s.preventDefault(),!!S())try{const m=L("auth_name");if(!m){o({title:"Error",description:"Sesi login tidak valid. Silakan login ulang.",variant:"destructive"}),n("/login");return}const h={name:e.name.trim(),start_date:e.start_date?new Date(e.start_date).toISOString().split("T")[0]:null,end_date:e.end_date?new Date(e.end_date).toISOString().split("T")[0]:null,volume:e.volume,satuan:e.satuan.trim(),harga_satuan:e.harga_satuan,username:e.username.trim(),password:e.password.trim(),lokasi_lisensi:((l=e.lokasi_lisensi)==null?void 0:l.trim())||null,description:((d=e.description)==null?void 0:d.trim())||null,last_user_input:m};await D("https://digio.pgn.co.id/lisa_backend/licenses/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),o({title:"Berhasil",description:"Data lisensi berhasil ditambahkan",variant:"success"}),n("/")}catch(m){console.error("Submit Error:",m),o({title:"Error",description:m instanceof Error?m.message:"Terjadi kesalahan saat menambahkan data lisensi",variant:"destructive"})}};return a.jsxs("div",{children:[a.jsx("header",{className:"bg-card border-b border-border shadow-sm",children:a.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[a.jsx("img",{src:"/lisa/logo-white.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain dark:hidden"}),a.jsx("img",{src:"/lisa/logo-dark.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain hidden dark:block"}),a.jsxs("div",{className:"hidden sm:block",children:[a.jsx("h1",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Lisensi Aset"}),a.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Sistem Monitoring Lisensi Aset"})]})]}),a.jsxs(u,{variant:"default",onClick:()=>n("/"),className:"flex items-center space-x-2",children:[a.jsx(T,{className:"w-4 h-4"}),a.jsx("span",{children:"Kembali"})]})]})})}),a.jsx("main",{className:"mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:a.jsx("div",{className:"space-y-6 sm:space-y-8",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"Tambah Lisensi"}),a.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Tambahkan data lisensi baru"})]})})}),a.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8 pb-8",children:a.jsxs("form",{onSubmit:I,className:"space-y-6",children:[a.jsx("div",{className:"bg-card p-4 sm:p-6 rounded-lg border border-border",children:a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:[a.jsxs("div",{children:[a.jsx(r,{htmlFor:"name",children:"Nama Aset"}),a.jsx(c,{id:"name",value:e.name,onChange:s=>i("name",s.target.value),"aria-invalid":!!t.name,className:"mt-1",placeholder:"Masukkan nama aset"}),t.name&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.name})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(r,{children:"Tanggal Mulai"}),a.jsxs(g,{children:[a.jsx(j,{asChild:!0,children:a.jsxs(u,{variant:"outline",className:p("w-full justify-start text-left font-normal mt-1",!e.start_date&&"text-muted-foreground"),children:[a.jsx(v,{className:"mr-2 h-4 w-4"}),e.start_date?N(new Date(e.start_date),"yyyy-MM-dd"):a.jsx("span",{children:"Pilih tanggal"})]})}),a.jsx(_,{className:"w-auto p-0",children:a.jsx(b,{mode:"single",selected:e.start_date?new Date(e.start_date):void 0,onSelect:s=>{i("start_date",(s==null?void 0:s.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.start_date&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.start_date})]}),a.jsxs("div",{children:[a.jsx(r,{children:"Tanggal Berakhir"}),a.jsxs(g,{children:[a.jsx(j,{asChild:!0,children:a.jsxs(u,{variant:"outline",className:p("w-full justify-start text-left font-normal mt-1",!e.end_date&&"text-muted-foreground"),children:[a.jsx(v,{className:"mr-2 h-4 w-4"}),e.end_date?N(new Date(e.end_date),"yyyy-MM-dd"):a.jsx("span",{children:"Pilih tanggal"})]})}),a.jsx(_,{className:"w-auto p-0",children:a.jsx(b,{mode:"single",selected:e.end_date?new Date(e.end_date):void 0,onSelect:s=>{i("end_date",(s==null?void 0:s.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.end_date&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.end_date})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(r,{htmlFor:"volume",children:"Volume"}),a.jsx(c,{id:"volume",type:"number",value:e.volume||"",onChange:s=>i("volume",Number(s.target.value)||""),"aria-invalid":!!t.volume,className:"mt-1",placeholder:"Masukkan volume"}),t.volume&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.volume})]}),a.jsxs("div",{children:[a.jsx(r,{htmlFor:"satuan",children:"Satuan"}),a.jsx(c,{id:"satuan",value:e.satuan,onChange:s=>i("satuan",s.target.value),"aria-invalid":!!t.satuan,className:"mt-1",placeholder:"Masukkan satuan"}),t.satuan&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.satuan})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(r,{htmlFor:"harga_satuan",children:"Harga Satuan"}),a.jsx(c,{id:"harga_satuan",type:"text",value:w,onChange:s=>C(s.target.value),"aria-invalid":!!t.harga_satuan,className:"mt-1",placeholder:"Masukkan harga satuan"}),t.harga_satuan&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.harga_satuan})]}),a.jsxs("div",{children:[a.jsx(r,{htmlFor:"jumlah",children:"Total Harga"}),a.jsx(c,{id:"jumlah",type:"text",value:e.jumlah>0?R(e.jumlah):"Rp 0",disabled:!0,className:"mt-1 bg-muted"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(r,{htmlFor:"username",children:"Username"}),a.jsx(c,{id:"username",value:e.username,onChange:s=>i("username",s.target.value),"aria-invalid":!!t.username,className:"mt-1",placeholder:"Masukkan username"}),t.username&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.username})]}),a.jsxs("div",{children:[a.jsx(r,{htmlFor:"password",children:"Password"}),a.jsx(c,{id:"password",type:"password",value:e.password,onChange:s=>i("password",s.target.value),"aria-invalid":!!t.password,className:"mt-1",placeholder:"Masukkan volume"}),t.password&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.password})]})]}),a.jsxs("div",{children:[a.jsx(r,{htmlFor:"lokasi_lisensi",children:"Lokasi"}),a.jsx(c,{id:"lokasi_lisensi",value:e.lokasi_lisensi,onChange:s=>i("lokasi_lisensi",s.target.value),className:"mt-1",placeholder:"Masukkan lokasi"})]}),a.jsxs("div",{children:[a.jsx(r,{htmlFor:"description",children:"Catatan"}),a.jsx(M,{id:"description",value:e.description,onChange:s=>i("description",s.target.value),className:"mt-1",rows:4,placeholder:"Masukkan catatan atau keterangan tambahan..."})]})]})}),a.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:[a.jsx(u,{type:"button",variant:"destructive",onClick:()=>n("/"),className:"w-full sm:w-auto order-2 sm:order-1",children:"Batal"}),a.jsx(u,{type:"submit",className:"w-full sm:w-auto order-1 sm:order-2",children:"Simpan"})]})]})})]})};export{J as AddLicense};
