import{J as X,j as q,r,u as W,a as e,v as P,C as Y,x as Z}from"./index-B5yO14EG.js";import{D as Q,l as ee,S as se,a as ae,b as te,c as re,d as k,T as ne,e as ie,f as y,g,h as le,i as m,L as oe,m as D,w as ce,A as de,n as me,o as xe}from"./xlsx-DHSLie14.js";import{B as p}from"./button-BLyQRZSy.js";import{I as he}from"./input-Q8JswDB5.js";import{b as F,C as ue}from"./index-Doupoh4T.js";import{C as ge}from"./circle-check-D8B2VLFM.js";const ke=({onLogout:pe})=>{const H=X(),{theme:M}=q(),[S,B]=r.useState(""),[_,$]=r.useState([]),[L,I]=r.useState(!0),[x,h]=r.useState(1),[f,R]=r.useState("10"),[C,V]=r.useState(1),[n,z]=r.useState(""),[j,E]=r.useState("asc"),{toast:w}=W(),A=async(s,a,t)=>{try{I(!0);let i=`https://digio.pgn.co.id/lisa_backend/licenses/get?page=${s}&paginate=${a}&name=`;t&&(i+=`${encodeURIComponent(t)}`);const u=await(await P(i)).json();if(u.status===200){let l=u.data.docs;n&&(l=[...l].sort((T,O)=>{let o=T[n],c=O[n];return n==="harga_satuan"&&(o=Number(o),c=Number(c)),(n==="start_date"||n==="end_date")&&(o=new Date(o).getTime(),c=new Date(c).getTime()),j==="asc"?o<c?-1:o>c?1:0:o>c?-1:o<c?1:0})),$(l),V(u.data.pages)}else throw new Error("Gagal memuat data lisensi")}catch{w({title:"Error",description:"Terjadi kesalahan saat memuat data lisensi",variant:"destructive"})}finally{I(!1)}};r.useEffect(()=>{A(x,parseInt(f))},[x,f,n,j]),r.useEffect(()=>{const s=setTimeout(()=>{A(1,parseInt(f),S),h(1)},500);return()=>clearTimeout(s)},[S]);const b=s=>{const a={day:"2-digit",month:"long",year:"numeric"};return new Date(s).toLocaleDateString("id-ID",a)},K=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),U=s=>{const a=new Date,t=new Date(s),i=Math.ceil((t.getTime()-a.getTime())/(1e3*60*60*24));return i<0?{text:"Sudah Kadaluarsa",color:"bg-red-100 text-red-700 border-red-200",icon:Y}:i<=120?{text:"Akan Kadaluarsa",color:"bg-yellow-100 text-yellow-700 border-yellow-200",icon:Z}:{text:"Aman",color:"bg-green-100 text-green-700 border-green-200",icon:ge}},G=async()=>{try{const a=await(await P("https://digio.pgn.co.id/lisa_backend/licenses/export")).json();if(a.status===200){const t=a.data.map((l,T)=>({No:T+1,"Nama Lisensi":l.name,"Harga Satuan":l.harga_satuan,"Tanggal Awal":b(l.start_date),"Tanggal Berakhir":b(l.end_date),Deskripsi:l.description})),i=D.json_to_sheet(t),d=D.book_new();D.book_append_sheet(d,i,"Harga Lisensi");const u=new Date().toISOString().split("T")[0];ce(d,`Harga_Lisensi_${u}.xlsx`),w({title:"Berhasil",description:"Data berhasil diekspor ke Excel",variant:"success"})}else w({title:"Info",description:"Tidak ada data yang bisa diekspor (data kosong)",variant:"warning"})}catch{w({title:"Error",description:"Gagal mengekspor data ke Excel",variant:"destructive"})}},N=s=>{n===s?E(j==="asc"?"desc":"asc"):(z(s),E("asc")),h(1)},v=s=>n!==s?e.jsx(de,{className:"w-4 h-4 ml-1 opacity-50"}):j==="asc"?e.jsx(me,{className:"w-4 h-4 ml-1"}):e.jsx(xe,{className:"w-4 h-4 ml-1"}),J=(s,a)=>{const t=[];t.push(1),s-2>2&&t.push("...");for(let d=Math.max(2,s-2);d<=Math.min(a-1,s+2);d++)t.push(d);return s+2<a-1&&t.push("..."),a>1&&t.push(a),t};return e.jsxs("div",{children:[e.jsx("header",{className:"bg-card border-b border-border shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("img",{src:M==="dark"?"/lisa/logo-dark.png":"/lisa/logo-white.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain"}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Lisensi Aset"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Sistem Monitoring Lisensi Aset"})]})]}),e.jsxs(p,{variant:"default",onClick:()=>H("/"),className:"flex items-center space-x-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"Kembali"})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:e.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"Harga Lisensi"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Daftar harga dan informasi lisensi aset perusahaan"})]}),e.jsx("div",{className:"flex gap-2 w-full sm:w-auto",children:e.jsxs(p,{onClick:G,variant:"success",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(Q,{className:"w-4 h-4"}),"Export Excel"]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm w-full md:w-auto",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(he,{placeholder:"Cari nama lisensi...",value:S,onChange:s=>B(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto justify-end",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Tampilkan:"}),e.jsxs(se,{value:f,onValueChange:R,children:[e.jsx(ae,{className:"w-16",children:e.jsx(te,{})}),e.jsxs(re,{children:[e.jsx(k,{value:"10",children:"10"}),e.jsx(k,{value:"25",children:"25"}),e.jsx(k,{value:"50",children:"50"}),e.jsx(k,{value:"100",children:"100"})]})]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(ne,{className:"[&_tr>*]:border-r [&_tr>*:last-child]:border-r-0 [&_tr]:border-b [&_tr:last-child]:border-b-0",children:[e.jsx(ie,{children:e.jsxs(y,{className:"bg-muted/50",children:[e.jsx(g,{className:"font-semibold cursor-pointer hover:bg-muted/70 transition-colors",onClick:()=>N("name"),children:e.jsxs("div",{className:"flex items-center",children:["Nama Lisensi",v("name")]})}),e.jsx(g,{className:"font-semibold cursor-pointer hover:bg-muted/70 transition-colors",onClick:()=>N("harga_satuan"),children:e.jsxs("div",{className:"flex items-center",children:["Harga Satuan",v("harga_satuan")]})}),e.jsx(g,{className:"font-semibold cursor-pointer hover:bg-muted/70 transition-colors",onClick:()=>N("start_date"),children:e.jsxs("div",{className:"flex items-center",children:["Tanggal Awal",v("start_date")]})}),e.jsx(g,{className:"font-semibold cursor-pointer hover:bg-muted/70 transition-colors",onClick:()=>N("end_date"),children:e.jsxs("div",{className:"flex items-center",children:["Tanggal Berakhir",v("end_date")]})}),e.jsx(g,{className:"font-semibold",children:"Catatan"})]})}),e.jsx(le,{children:L?e.jsx(y,{children:e.jsxs(m,{colSpan:6,className:"h-32 text-center",children:[e.jsx(oe,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),e.jsx("p",{children:"Memuat data..."})]})}):_.length===0?e.jsx(y,{children:e.jsx(m,{colSpan:6,className:"h-32 text-center",children:e.jsx("p",{children:"Tidak ada data yang ditemukan"})})}):_.map(s=>(U(s.end_date).icon,e.jsxs(y,{className:"hover:bg-muted/30 transition-colors",children:[e.jsx(m,{className:"font-medium",children:s.name}),e.jsx(m,{className:"text-right whitespace-nowrap",children:K(s.harga_satuan)}),e.jsx(m,{className:"whitespace-nowrap",children:b(s.start_date)}),e.jsx(m,{className:"whitespace-nowrap",children:b(s.end_date)}),e.jsx(m,{className:"max-w-xs truncate",children:s.description})]},s.uuid)))})]})}),!L&&_.length>0&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>h(s=>Math.max(1,s-1)),disabled:x===1,children:e.jsx(F,{className:"w-4 h-4"})}),J(x,C).map((s,a)=>e.jsx(p,{variant:x===s?"default":"outline",size:"sm",onClick:()=>typeof s=="number"&&h(s),disabled:s==="...",children:s},a)),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>h(s=>Math.min(C,s+1)),disabled:x===C,children:e.jsx(ue,{className:"w-4 h-4"})})]})]})})]})};export{ke as default};
