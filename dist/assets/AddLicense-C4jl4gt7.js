import{W as R,u as O,r as h,a,B as x,L as l,I as m,k as v,a4 as A,U as B,e as V}from"./index-ByCW27ks.js";import{P as _,a as b,C as N,f as w,b as f,c as k,T as H}from"./popover-Bbned-nQ.js";import{C as K}from"./chevron-left-hrojxHCq.js";import{E as U,a as $}from"./eye-BxdyZp2k.js";const q={name:"",start_date:"",end_date:"",volume:"",satuan:"",harga_satuan:"",jumlah:0,username:"",password:"",lokasi_lisensi:"",description:"",last_user_input:""},z=d=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(d),J=d=>{const c=d.replace(/\D/g,"");return c?`Rp. ${new Intl.NumberFormat("id-ID").format(parseInt(c))}`:""},W=d=>{const c=d.replace(/Rp\.\s?/g,"").replace(/\./g,"");return parseInt(c)||0},Z=()=>{const d=R(),{toast:c}=O(),[e,y]=h.useState(q),[t,g]=h.useState({}),[S,C]=h.useState(""),[p,I]=h.useState(!1),[D,E]=h.useState(!1);h.useEffect(()=>{E(window.self!==window.top)},[]);const T=()=>{const s={};if(["name","start_date","end_date","volume","satuan","harga_satuan","username","password"].forEach(i=>{e[i]||(s[i]="Field ini wajib diisi")}),e.volume&&e.volume<=0&&(s.volume="Volume harus lebih besar dari 0"),e.harga_satuan&&e.harga_satuan<0&&(s.harga_satuan="Harga satuan tidak boleh negatif"),e.start_date&&e.end_date){const i=new Date(e.start_date),r=new Date(e.end_date);i>r&&(s.start_date="Tanggal mulai tidak boleh lebih besar dari tanggal berakhir",s.end_date="Tanggal berakhir tidak boleh lebih kecil dari tanggal mulai")}return g(s),Object.keys(s).length===0},o=(s,n)=>{const i={...e,[s]:n};if(s==="volume"||s==="harga_satuan"){const r=s==="volume"?Number(n):Number(e.volume)||0,u=s==="harga_satuan"?Number(n):Number(e.harga_satuan)||0;i.jumlah=r*u}if(s==="start_date"||s==="end_date"){const r={...t},u=s==="start_date"?n:e.start_date,j=s==="end_date"?n:e.end_date;if(u&&j){const M=new Date(u),P=new Date(j);M>P?(r.start_date="Tanggal mulai tidak boleh lebih besar dari tanggal berakhir",r.end_date="Tanggal berakhir tidak boleh lebih kecil dari tanggal mulai"):(delete r.start_date,delete r.end_date)}else delete r.start_date,delete r.end_date;g(r)}y(i)},F=s=>{const n=J(s);C(n);const i=W(n);o("harga_satuan",i)},L=async s=>{var n,i;if(s.preventDefault(),!!T())try{const r=A("auth_name");if(!r){c({title:"Error",description:"Sesi login tidak valid. Silakan login ulang.",variant:"destructive"}),d("/login");return}const u={name:e.name.trim(),start_date:e.start_date?new Date(e.start_date).toISOString().split("T")[0]:null,end_date:e.end_date?new Date(e.end_date).toISOString().split("T")[0]:null,volume:e.volume,satuan:e.satuan.trim(),harga_satuan:e.harga_satuan,username:e.username.trim(),password:e.password.trim(),lokasi_lisensi:((n=e.lokasi_lisensi)==null?void 0:n.trim())||null,description:((i=e.description)==null?void 0:i.trim())||null,last_user_input:r};await B(`${V}/licenses/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),c({title:"Berhasil",description:"Data lisensi berhasil ditambahkan",variant:"success"}),d("/")}catch(r){console.error("Submit Error:",r),c({title:"Error",description:r instanceof Error?r.message:"Terjadi kesalahan saat menambahkan data lisensi",variant:"destructive"})}};return a.jsxs("div",{children:[a.jsx("header",{className:"bg-card border-b border-border shadow-sm",children:a.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[a.jsx("img",{src:"/lisa/logo-white.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain dark:hidden"}),a.jsx("img",{src:"/lisa/logo-dark.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain hidden dark:block"}),a.jsxs("div",{className:"hidden sm:block",children:[a.jsx("h1",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Lisensi Aset"}),a.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Sistem Monitoring Lisensi Aset"})]})]}),!D&&a.jsxs(x,{variant:"default",onClick:()=>d("/"),className:"flex items-center space-x-2",children:[a.jsx(K,{className:"w-4 h-4"}),a.jsx("span",{children:"Kembali"})]})]})})}),a.jsx("main",{className:"mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:a.jsx("div",{className:"space-y-6 sm:space-y-8",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"Tambah Lisensi"}),a.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Tambahkan data lisensi baru"})]})})}),a.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8 pb-8",children:a.jsxs("form",{onSubmit:L,className:"space-y-6",children:[a.jsx("div",{className:"bg-card p-4 sm:p-6 rounded-lg border border-border",children:a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:[a.jsxs("div",{children:[a.jsx(l,{htmlFor:"name",children:"Nama Aset"}),a.jsx(m,{id:"name",value:e.name,onChange:s=>o("name",s.target.value),"aria-invalid":!!t.name,className:"mt-1",placeholder:"Masukkan nama aset"}),t.name&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.name})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(l,{children:"Tanggal Mulai"}),a.jsxs(_,{children:[a.jsx(b,{asChild:!0,children:a.jsxs(x,{variant:"outline",className:v("w-full justify-start text-left font-normal mt-1",!e.start_date&&"text-muted-foreground"),children:[a.jsx(N,{className:"mr-2 h-4 w-4"}),e.start_date?w(new Date(e.start_date),"yyyy-MM-dd"):a.jsx("span",{children:"Pilih tanggal"})]})}),a.jsx(f,{className:"w-auto p-0",children:a.jsx(k,{mode:"single",selected:e.start_date?new Date(e.start_date):void 0,onSelect:s=>{o("start_date",(s==null?void 0:s.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.start_date&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.start_date})]}),a.jsxs("div",{children:[a.jsx(l,{children:"Tanggal Berakhir"}),a.jsxs(_,{children:[a.jsx(b,{asChild:!0,children:a.jsxs(x,{variant:"outline",className:v("w-full justify-start text-left font-normal mt-1",!e.end_date&&"text-muted-foreground"),children:[a.jsx(N,{className:"mr-2 h-4 w-4"}),e.end_date?w(new Date(e.end_date),"yyyy-MM-dd"):a.jsx("span",{children:"Pilih tanggal"})]})}),a.jsx(f,{className:"w-auto p-0",children:a.jsx(k,{mode:"single",selected:e.end_date?new Date(e.end_date):void 0,onSelect:s=>{o("end_date",(s==null?void 0:s.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.end_date&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.end_date})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(l,{htmlFor:"volume",children:"Volume"}),a.jsx(m,{id:"volume",type:"number",value:e.volume||"",onChange:s=>o("volume",Number(s.target.value)||""),"aria-invalid":!!t.volume,className:"mt-1",placeholder:"Masukkan volume"}),t.volume&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.volume})]}),a.jsxs("div",{children:[a.jsx(l,{htmlFor:"satuan",children:"Satuan"}),a.jsx(m,{id:"satuan",value:e.satuan,onChange:s=>o("satuan",s.target.value),"aria-invalid":!!t.satuan,className:"mt-1",placeholder:"Masukkan satuan"}),t.satuan&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.satuan})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(l,{htmlFor:"harga_satuan",children:"Harga Satuan"}),a.jsx(m,{id:"harga_satuan",type:"text",value:S,onChange:s=>F(s.target.value),"aria-invalid":!!t.harga_satuan,className:"mt-1",placeholder:"Masukkan harga satuan"}),t.harga_satuan&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.harga_satuan})]}),a.jsxs("div",{children:[a.jsx(l,{htmlFor:"jumlah",children:"Total Harga"}),a.jsx(m,{id:"jumlah",type:"text",value:e.jumlah>0?z(e.jumlah):"Rp 0",disabled:!0,className:"mt-1 bg-muted"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(l,{htmlFor:"username",children:"Username"}),a.jsx(m,{id:"username",value:e.username,onChange:s=>o("username",s.target.value),"aria-invalid":!!t.username,className:"mt-1",placeholder:"Masukkan username"}),t.username&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.username})]}),a.jsxs("div",{children:[a.jsx(l,{htmlFor:"password",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(m,{id:"password",type:p?"text":"password",value:e.password,onChange:s=>o("password",s.target.value),"aria-invalid":!!t.password,className:"mt-1 pr-10",placeholder:"Masukkan password"}),a.jsx(x,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>I(!p),children:p?a.jsx(U,{className:"w-4 h-4"}):a.jsx($,{className:"w-4 h-4"})})]}),t.password&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.password})]})]}),a.jsxs("div",{children:[a.jsx(l,{htmlFor:"lokasi_lisensi",children:"Lokasi"}),a.jsx(m,{id:"lokasi_lisensi",value:e.lokasi_lisensi,onChange:s=>o("lokasi_lisensi",s.target.value),className:"mt-1",placeholder:"Masukkan lokasi"})]}),a.jsxs("div",{children:[a.jsx(l,{htmlFor:"description",children:"Catatan"}),a.jsx(H,{id:"description",value:e.description,onChange:s=>o("description",s.target.value),className:"mt-1",rows:4,placeholder:"Masukkan catatan atau keterangan tambahan..."})]})]})}),a.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:[a.jsx(x,{type:"button",variant:"destructive",onClick:()=>d("/"),className:"w-full sm:w-auto order-2 sm:order-1",children:"Batal"}),a.jsx(x,{type:"submit",className:"w-full sm:w-auto order-1 sm:order-2",children:"Simpan"})]})]})})]})};export{Z as AddLicense};
