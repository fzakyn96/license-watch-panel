import{L as R,I as K,u as $,j as B,r as h,a as e,l as v,o as N,C as O,q as V,K as q}from"./index-Cqebowdb.js";import{B as x}from"./button-BnZCjPkm.js";import{I as o}from"./input-BIRgTtVD.js";import{P as w,a as b,C as y,f as _,b as f,c as k,T as H}from"./popover-DK3_zwOk.js";import{L as i}from"./label-Cu79th1q.js";import{b as G}from"./index-DP5uO3yg.js";import{C as U}from"./circle-check-DzHq4JpH.js";const J=d=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(d),C=d=>{const c=d.replace(/\D/g,"");return c?`Rp. ${new Intl.NumberFormat("id-ID").format(parseInt(c))}`:""},X=d=>{const c=d.replace(/Rp\.\s?/g,"").replace(/\./g,"");return parseInt(c)||0},se=()=>{const{uuid:d}=R(),c=K(),{toast:p}=$(),{theme:S}=B(),[I,E]=h.useState(!0),[s,g]=h.useState(null),[t,F]=h.useState({}),[L,j]=h.useState("");h.useEffect(()=>{d&&(async()=>{try{const r=await(await N(`https://digio.pgn.co.id/lisa_backend/licenses/find?uuid=${d}`)).json();if(r.status===200&&r.data){const{history_licenses:m,...u}=r.data;g(u),u.harga_satuan&&j(C(u.harga_satuan.toString()))}else throw new Error("Gagal memuat data lisensi")}catch{p({title:"Error",description:"Terjadi kesalahan saat memuat data lisensi",variant:"destructive"}),c("/")}finally{E(!1)}})()},[d]);const M=()=>{const a={};return["name","start_date","end_date","volume","satuan","harga_satuan","username","password"].forEach(r=>{s!=null&&s[r]||(a[r]="Field ini wajib diisi")}),s!=null&&s.volume&&s.volume<=0&&(a.volume="Volume harus lebih besar dari 0"),s!=null&&s.harga_satuan&&s.harga_satuan<0&&(a.harga_satuan="Harga satuan tidak boleh negatif"),F(a),Object.keys(a).length===0},l=(a,n)=>{if(!s)return;const r={...s,[a]:n};if(a==="volume"||a==="harga_satuan"){const m=a==="volume"?Number(n):s.volume,u=a==="harga_satuan"?Number(n):s.harga_satuan;r.jumlah=m*u}g(r)},T=a=>{const n=C(a);j(n);const r=X(n);l("harga_satuan",r)},P=a=>{const n=new Date,r=new Date(a),m=Math.ceil((r.getTime()-n.getTime())/(1e3*60*60*24));return m<0?{text:"Sudah Kadaluarsa",color:"bg-red-100 text-red-700 border-red-200",icon:O}:m<=120?{text:"Akan Kadaluarsa",color:"bg-yellow-100 text-yellow-700 border-yellow-200",icon:V}:{text:"Aman",color:"bg-green-100 text-green-700 border-green-200",icon:U}},A=async a=>{if(a.preventDefault(),!!M())try{const n=q("auth_name")||"",r={...s,last_user_input:n,updatedAt:new Date().toISOString()};if((await N("https://digio.pgn.co.id/lisa_backend/licenses/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)p({title:"Berhasil",description:"Data lisensi berhasil diperbarui",variant:"success"}),c("/");else throw new Error("Gagal memperbarui data")}catch{p({title:"Error",description:"Terjadi kesalahan saat memperbarui data lisensi",variant:"destructive"})}};return I?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Memuat..."}):e.jsxs("div",{children:[e.jsx("header",{className:"bg-card border-b border-border shadow-sm",children:e.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("img",{src:S==="dark"?"/lisa/logo-dark.png":"/lisa/logo-white.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain"}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Lisensi Aset"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Sistem Monitoring Lisensi Aset"})]})]}),e.jsxs(x,{variant:"default",onClick:()=>c("/"),className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Kembali"})]})]})})}),e.jsx("main",{className:"mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:e.jsx("div",{className:"space-y-6 sm:space-y-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"Edit Lisensi"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Edit data lisensi yang sudah ada"})]}),(s==null?void 0:s.end_date)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),(()=>{const a=P(s.end_date),n=a.icon;return e.jsxs("div",{className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium border ${a.color}`,children:[e.jsx(n,{className:"w-4 h-4 mr-1.5"}),a.text]})})()]})]})})}),e.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8 pb-8",children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsx("div",{className:"bg-card p-4 sm:p-6 rounded-lg border border-border",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(i,{htmlFor:"name",children:"Nama Aset"}),e.jsx(o,{id:"name",value:(s==null?void 0:s.name)||"",onChange:a=>l("name",a.target.value),"aria-invalid":!!t.name,className:"mt-1",placeholder:"Masukkan nama aset"}),t.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.name})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Tanggal Mulai"}),e.jsxs(w,{children:[e.jsx(b,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:v("w-full justify-start text-left font-normal mt-1",!(s!=null&&s.start_date)&&"text-muted-foreground"),children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),s!=null&&s.start_date?_(new Date(s.start_date),"yyyy-MM-dd"):e.jsx("span",{children:"Pilih tanggal"})]})}),e.jsx(f,{className:"w-auto p-0",children:e.jsx(k,{mode:"single",selected:s!=null&&s.start_date?new Date(s.start_date):void 0,onSelect:a=>{l("start_date",(a==null?void 0:a.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.start_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.start_date})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Tanggal Berakhir"}),e.jsxs(w,{children:[e.jsx(b,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:v("w-full justify-start text-left font-normal mt-1",!(s!=null&&s.end_date)&&"text-muted-foreground"),children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),s!=null&&s.end_date?_(new Date(s.end_date),"yyyy-MM-dd"):e.jsx("span",{children:"Pilih tanggal"})]})}),e.jsx(f,{className:"w-auto p-0",children:e.jsx(k,{mode:"single",selected:s!=null&&s.end_date?new Date(s.end_date):void 0,onSelect:a=>{l("end_date",(a==null?void 0:a.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.end_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.end_date})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"volume",children:"Volume"}),e.jsx(o,{id:"volume",type:"number",value:(s==null?void 0:s.volume)||"",onChange:a=>l("volume",Number(a.target.value)),"aria-invalid":!!t.volume,className:"mt-1",placeholder:"Masukkan volume"}),t.volume&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.volume})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"satuan",children:"Satuan"}),e.jsx(o,{id:"satuan",value:(s==null?void 0:s.satuan)||"",onChange:a=>l("satuan",a.target.value),"aria-invalid":!!t.satuan,className:"mt-1",placeholder:"Masukkan satuan"}),t.satuan&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.satuan})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"harga_satuan",children:"Harga Satuan"}),e.jsx(o,{id:"harga_satuan",type:"text",value:L,onChange:a=>T(a.target.value),"aria-invalid":!!t.harga_satuan,className:"mt-1",placeholder:"Masukkan harga satuan"}),t.harga_satuan&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.harga_satuan})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"jumlah",children:"Total Harga"}),e.jsx(o,{id:"jumlah",type:"text",value:s!=null&&s.jumlah?J(s.jumlah):"Rp 0",disabled:!0,className:"mt-1 bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"username",children:"Username"}),e.jsx(o,{id:"username",value:(s==null?void 0:s.username)||"",onChange:a=>l("username",a.target.value),"aria-invalid":!!t.username,className:"mt-1",placeholder:"Masukkan username"}),t.username&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.username})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Password"}),e.jsx(o,{id:"password",type:"password",value:(s==null?void 0:s.password)||"",onChange:a=>l("password",a.target.value),"aria-invalid":!!t.password,className:"mt-1",placeholder:"Masukkan password"}),t.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.password})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"lokasi_lisensi",children:"Lokasi"}),e.jsx(o,{id:"lokasi_lisensi",value:(s==null?void 0:s.lokasi_lisensi)||"",onChange:a=>l("lokasi_lisensi",a.target.value),className:"mt-1",placeholder:"Masukkan lokasi"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"description",children:"Catatan"}),e.jsx(H,{id:"description",value:(s==null?void 0:s.description)||"",onChange:a=>l("description",a.target.value),className:"mt-1",rows:4,placeholder:"Masukkan catatan atau keterangan tambahan..."})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:[e.jsx(x,{type:"button",variant:"destructive",onClick:()=>c("/"),className:"w-full sm:w-auto order-2 sm:order-1",children:"Batal"}),e.jsx(x,{type:"submit",className:"w-full sm:w-auto order-1 sm:order-2",children:"Simpan"})]})]})})]})};export{se as EditLicense};
