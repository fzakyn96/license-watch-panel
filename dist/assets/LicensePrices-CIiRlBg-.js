import{V as Ae,j as Fe,r as n,u as Be,a as e,B as h,I as re,S as ie,q as le,t as ne,v as ce,w as b,D as R,m as oe,n as Me,o as Oe,p as $e,T as de,x as me,y,z as u,E as xe,F as c,$ as he,l as ue,R as pe}from"./index-DzIjZ1YM.js";import{D as je,S as ge,H as W,u as f,w as fe,A as we,a as Ne,b as ve}from"./xlsx-RuzRMnH0.js";import{C as q}from"./chevron-left-r_k5Roy4.js";const Ge=({onLogout:Re})=>{const be=Ae(),{theme:ye}=Fe(),[P,ke]=n.useState(""),[E,_e]=n.useState([]),[K,J]=n.useState(!0),[k,C]=n.useState(1),[A,Se]=n.useState("10"),[z,Ce]=n.useState(1),[De,Te]=n.useState(0),[j,He]=n.useState(""),[F,X]=n.useState("asc"),[D,Y]=n.useState(""),[g,Z]=n.useState(""),[V,U]=n.useState("asc"),[w,T]=n.useState(1),[_,Q]=n.useState(5),[ee,H]=n.useState(!1),[x,Le]=n.useState(null),{toast:S}=Be(),se=async(s,a,t)=>{try{J(!0);let d=`https://digio.pgn.co.id/lisa_backend/licenses/get?page=${s}&paginate=${a}&sortField=end_date&sortDirection=desc&name=`;t&&(d+=`${encodeURIComponent(t)}`);const r=await(await pe(d)).json();if(r.status===200){let v=r.data.docs;j&&(v=[...v].sort((l,I)=>{let m=l[j],p=I[j];return j==="harga_satuan"&&(m=Number(m),p=Number(p)),(j==="start_date"||j==="end_date")&&(m=new Date(m).getTime(),p=new Date(p).getTime()),F==="asc"?m<p?-1:m>p?1:0:m>p?-1:m<p?1:0})),_e(v),Ce(r.data.pages),Te(r.data.total)}else throw new Error("Gagal memuat data lisensi")}catch{S({title:"Error",description:"Terjadi kesalahan saat memuat data lisensi",variant:"destructive"})}finally{J(!1)}};n.useEffect(()=>{if(P){const s=setTimeout(()=>{se(1,parseInt(A),P),C(1)},500);return()=>clearTimeout(s)}else se(k,parseInt(A))},[k,A,j,F,P]);const o=s=>{const a={day:"2-digit",month:"long",year:"numeric"};return new Date(s).toLocaleDateString("id-ID",a)},L=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),ae=(s,a)=>{Le(a),H(!0)},Ie=async()=>{try{const a=await(await pe("https://digio.pgn.co.id/lisa_backend/licenses/export")).json();if(a.status===200){const t=a.data.map((l,I)=>({No:I+1,"Nama Lisensi":l.name,Volume:l.volume,Satuan:l.satuan,"Harga Satuan":l.harga_satuan,"Total Harga":l.jumlah,"Tanggal Mulai":o(l.start_date),"Tanggal Berakhir":o(l.end_date),"Lokasi Lisensi":l.lokasi_lisensi,Deskripsi:l.description,"Terakhir Diubah Oleh":l.last_user_input})),d=[];a.data.forEach((l,I)=>{l.history_licenses&&l.history_licenses.length>0&&l.history_licenses.forEach((m,p)=>{d.push({No:`${I+1}.${p+1}`,"Nama Lisensi":l.name,"Harga Satuan (History)":m.harga_satuan,"Berlaku Sejak":o(m.tanggal),"Deskripsi (History)":m.description,"Terakhir Input Oleh":m.last_user_input,"Dibuat Pada":o(m.createdAt)})})});const i=f.book_new(),r=f.json_to_sheet(t);if(f.book_append_sheet(i,r,"Harga Lisensi"),d.length>0){const l=f.json_to_sheet(d);f.book_append_sheet(i,l,"Riwayat Harga")}const v=new Date().toISOString().split("T")[0];fe(i,`Harga_Lisensi_${v}.xlsx`),S({title:"Berhasil",description:"Data berhasil diekspor ke Excel dengan history",variant:"success"})}else S({title:"Info",description:"Tidak ada data yang bisa diekspor (data kosong)",variant:"warning"})}catch{S({title:"Error",description:"Gagal mengekspor data ke Excel",variant:"destructive"})}},B=s=>{j===s?X(F==="asc"?"desc":"asc"):(He(s),X("asc")),C(1)},M=s=>j!==s?e.jsx(we,{className:"w-4 h-4 ml-1 opacity-50"}):F==="asc"?e.jsx(Ne,{className:"w-4 h-4 ml-1"}):e.jsx(ve,{className:"w-4 h-4 ml-1"}),te=(s,a)=>{const t=[];t.push(1),s-2>2&&t.push("...");for(let i=Math.max(2,s-2);i<=Math.min(a-1,s+2);i++)t.push(i);return s+2<a-1&&t.push("..."),a>1&&t.push(a),t},O=s=>{g===s?U(V==="asc"?"desc":"asc"):(Z(s),U("asc")),T(1)},$=s=>g!==s?e.jsx(we,{className:"w-4 h-4 ml-1 opacity-50"}):V==="asc"?e.jsx(Ne,{className:"w-4 h-4 ml-1"}):e.jsx(ve,{className:"w-4 h-4 ml-1"}),Pe=s=>{let a=s;return D&&(a=s.filter(t=>t.description.toLowerCase().includes(D.toLowerCase())||t.last_user_input.toLowerCase().includes(D.toLowerCase())||L(t.harga_satuan).toLowerCase().includes(D.toLowerCase()))),g&&(a=[...a].sort((t,d)=>{let i=t[g],r=d[g];return g==="harga_satuan"&&(i=Number(i),r=Number(r)),(g==="tanggal"||g==="createdAt")&&(i=new Date(i).getTime(),r=new Date(r).getTime()),V==="asc"?i<r?-1:i>r?1:0:i>r?-1:i<r?1:0})),a},N=s=>{const a=Pe(s),t=(w-1)*_,d=t+_;return{items:a.slice(t,d),totalItems:a.length,totalPages:Math.ceil(a.length/_)}},Ee=s=>{try{const a=s.history_licenses.map((r,v)=>({No:v+1,"Nama Lisensi":s.name,"Harga Satuan":r.harga_satuan,"Berlaku Sejak":o(r.tanggal),Deskripsi:r.description,"Terakhir Input Oleh":r.last_user_input,"Dibuat Pada":o(r.createdAt)})),t=f.book_new(),d=f.json_to_sheet(a);f.book_append_sheet(t,d,"Riwayat Harga");const i=new Date().toISOString().split("T")[0];fe(t,`Riwayat Harga Lisensi_${s.name}_${i}.xlsx`),S({title:"Berhasil",description:"History berhasil diekspor ke Excel",variant:"success"})}catch{S({title:"Error",description:"Gagal mengekspor history ke Excel",variant:"destructive"})}},G=()=>{Y(""),Z(""),U("asc"),T(1),Q(5)};return e.jsxs("div",{children:[e.jsx("header",{className:"bg-card border-b border-border shadow-sm",children:e.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("img",{src:ye==="dark"?"/lisa/logo-dark.png":"/lisa/logo-white.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain"}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Lisensi Aset"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Sistem Monitoring Lisensi Aset"})]})]}),e.jsxs(h,{variant:"default",onClick:()=>be("/"),className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Kembali"})]})]})})}),e.jsx("main",{className:"mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:e.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"Harga Lisensi"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Daftar harga dan informasi lisensi"})]}),e.jsx("div",{className:"flex gap-2 w-full sm:w-auto",children:e.jsxs(h,{onClick:Ie,variant:"success",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(je,{className:"w-4 h-4"}),"Export Excel"]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsx("div",{children:e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-foreground",children:"Daftar Harga Lisensi"})})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm w-full md:w-auto",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(re,{placeholder:"Cari lisensi...",value:P,onChange:s=>ke(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap",children:["Total Data: ",De," - Tampilkan:"]}),e.jsxs(ie,{value:A,onValueChange:Se,children:[e.jsx(le,{className:"w-full sm:w-24",children:e.jsx(ne,{})}),e.jsxs(ce,{children:[e.jsx(b,{value:"10",children:"10"}),e.jsx(b,{value:"25",children:"25"}),e.jsx(b,{value:"50",children:"50"}),e.jsx(b,{value:"100",children:"100"})]})]})]})]}),e.jsx(R,{open:ee,onOpenChange:H,children:e.jsxs(oe,{className:"max-w-[95vw] w-full sm:max-w-4xl max-h-[90vh] flex flex-col p-4 sm:p-6",children:[e.jsx(R,{open:ee,onOpenChange:s=>{H(s),s||G()},children:e.jsxs(oe,{className:"w-full max-w-full sm:max-w-4xl",onOpenAutoFocus:s=>s.preventDefault(),children:[e.jsxs(Me,{children:[e.jsxs(Oe,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Riwayat Harga Lisensi"]}),e.jsxs($e,{className:"text-left",children:["Detail riwayat harga lisensi: ",x==null?void 0:x.name]})]}),x&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 flex-wrap w-full",children:[e.jsxs("div",{className:"relative w-full sm:max-w-xs",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(re,{placeholder:"Cari...",value:D,onChange:s=>Y(s.target.value),className:"pl-10 w-full",tabIndex:-1})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Tampilkan:"}),e.jsxs(ie,{value:_.toString(),onValueChange:s=>Q(Number(s)),children:[e.jsx(le,{className:"w-full sm:w-24",children:e.jsx(ne,{})}),e.jsxs(ce,{children:[e.jsx(b,{value:"5",children:"5"}),e.jsx(b,{value:"10",children:"10"}),e.jsx(b,{value:"20",children:"20"})]})]})]})]}),e.jsx("div",{className:"hidden sm:block border rounded-lg overflow-x-auto",children:e.jsxs(de,{className:"w-full min-w-[700px] text-sm",children:[e.jsx(me,{children:e.jsxs(y,{className:"bg-muted/50 border-b",children:[e.jsx(u,{className:"w-12 text-center",children:"No"}),e.jsx(u,{onClick:()=>O("harga_satuan"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center",children:["Harga Satuan",$("harga_satuan")]})}),e.jsx(u,{onClick:()=>O("tanggal"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center",children:["Berlaku Sejak",$("tanggal")]})}),e.jsx(u,{children:"Deskripsi"}),e.jsx(u,{onClick:()=>O("last_user_input"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center",children:["User",$("last_user_input")]})}),e.jsx(u,{onClick:()=>O("createdAt"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center",children:["Dibuat Pada",$("createdAt")]})})]})}),e.jsxs(xe,{children:[N(x.history_licenses).items.map((s,a)=>e.jsxs(y,{children:[e.jsx(c,{className:"text-center",children:(w-1)*_+a+1}),e.jsx(c,{children:L(s.harga_satuan)}),e.jsx(c,{children:o(s.tanggal)}),e.jsx(c,{className:"whitespace-pre-wrap break-words max-w-[200px]",children:s.description}),e.jsx(c,{children:s.last_user_input}),e.jsx(c,{children:o(s.createdAt)})]},s.id)),N(x.history_licenses).items.length===0&&e.jsx(y,{children:e.jsx(c,{colSpan:6,className:"text-center py-6 text-muted-foreground",children:"Tidak ada data riwayat"})})]})]})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:N(x.history_licenses).items.length>0?N(x.history_licenses).items.map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-card",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mb-1",children:[e.jsxs("span",{children:["No: ",(w-1)*_+a+1]}),e.jsx("span",{children:o(s.tanggal)})]}),e.jsx("div",{className:"font-medium text-sm",children:L(s.harga_satuan)}),e.jsx("div",{className:"text-xs text-slate-400 whitespace-pre-wrap break-words mb-2",children:s.description}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["User: ",s.last_user_input]}),e.jsxs("span",{children:["Dibuat: ",o(s.createdAt)]})]})]},s.id)):e.jsx("div",{className:"text-center py-6 text-muted-foreground text-sm",children:"Tidak ada data riwayat"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 mt-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-wrap justify-center sm:justify-start w-full sm:w-auto",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>T(s=>Math.max(1,s-1)),disabled:w===1,children:e.jsx(q,{className:"w-4 h-4"})}),te(w,N(x.history_licenses).totalPages).map((s,a)=>e.jsx(h,{variant:w===s?"default":"outline",size:"sm",onClick:()=>typeof s=="number"&&T(s),disabled:s==="...",children:s},a)),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>T(s=>Math.min(N(x.history_licenses).totalPages,s+1)),disabled:w===N(x.history_licenses).totalPages,children:e.jsx(he,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto",children:[e.jsxs(h,{variant:"success",onClick:()=>x&&Ee(x),className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(je,{className:"w-4 h-4"}),"Export"]}),e.jsx(h,{variant:"destructive",onClick:()=>H(!1),className:"w-full sm:w-auto",children:"Tutup"})]})]})]})]})}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(h,{variant:"destructive",onClick:()=>H(!1),children:"Batal"})})]})}),e.jsx("div",{className:"hidden sm:block w-full overflow-x-auto border rounded-lg overflow-x-auto",children:e.jsxs(de,{className:"[&_tr>*]:border-r [&_tr>*:last-child]:border-r-0 [&_tr]:border-b [&_tr:last-child]:border-b-0",children:[e.jsx(me,{children:e.jsxs(y,{className:"bg-muted/50 border-b",children:[e.jsx(u,{className:"w-[80px] whitespace-nowrap",children:"Aksi"}),e.jsx(u,{className:"w-[200px] whitespace-nowrap cursor-pointer hover:bg-muted/70",onClick:()=>B("name"),children:e.jsxs("div",{className:"flex items-center",children:["Nama Lisensi",M("name")]})}),e.jsx(u,{className:"w-[150px] whitespace-nowrap cursor-pointer hover:bg-muted/70",onClick:()=>B("harga_satuan"),children:e.jsxs("div",{className:"flex items-center",children:["Harga Satuan",M("harga_satuan")]})}),e.jsx(u,{className:"w-[150px] whitespace-nowrap cursor-pointer hover:bg-muted/70",onClick:()=>B("start_date"),children:e.jsxs("div",{className:"flex items-center",children:["Tanggal Mulai",M("start_date")]})}),e.jsx(u,{className:"w-[150px] whitespace-nowrap cursor-pointer hover:bg-muted/70",onClick:()=>B("end_date"),children:e.jsxs("div",{className:"flex items-center",children:["Tanggal Berakhir",M("end_date")]})}),e.jsx(u,{className:"w-[200px] whitespace-nowrap",children:"Catatan"})]})}),e.jsx(xe,{className:"[&_tr:last-child]:border-b-0",children:K?e.jsx(y,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Memuat data..."})}):E.length===0?e.jsx(y,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"Tidak ada data harga lisensi yang ditemukan"})}):E.map(s=>e.jsxs(y,{className:"hover:bg-muted/30",children:[e.jsx(c,{className:"text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(R,{onOpenChange:a=>!a&&G(),children:e.jsx(ue,{asChild:!0,children:e.jsx(h,{variant:"default",size:"sm",onClick:()=>ae("History",s),children:e.jsx(W,{className:"w-4 h-4"})})})})})}),e.jsx(c,{className:"font-medium",children:s.name}),e.jsx(c,{className:"text-right whitespace-nowrap",children:L(s.harga_satuan)}),e.jsx(c,{className:"whitespace-nowrap",children:o(s.start_date)}),e.jsx(c,{className:"whitespace-nowrap",children:o(s.end_date)}),e.jsx(c,{className:"max-w-xs",children:e.jsx("div",{className:"truncate",title:s.description,children:s.description})})]},s.uuid))})]})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:E.map(s=>e.jsxs("div",{className:"rounded-lg border bg-card p-4 shadow-sm flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsx(R,{onOpenChange:a=>!a&&G(),children:e.jsx(ue,{asChild:!0,children:e.jsx(h,{variant:"default",size:"sm",onClick:()=>ae("History",s),children:e.jsx(W,{className:"w-4 h-4"})})})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Harga:"})," ",L(s.harga_satuan)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Mulai:"})," ",o(s.start_date)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Berakhir:"})," ",o(s.end_date)]})]})]},s.uuid))}),!K&&E.length>0&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>C(s=>Math.max(1,s-1)),disabled:k===1,children:e.jsx(q,{className:"w-4 h-4"})}),te(k,z).map((s,a)=>e.jsx(h,{variant:k===s?"default":"outline",size:"sm",onClick:()=>typeof s=="number"&&C(s),disabled:s==="...",children:s},a)),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>C(s=>Math.min(z,s+1)),disabled:k===z,children:e.jsx(he,{className:"w-4 h-4"})})]})]})]})})]})};export{Ge as default};
