import{e as ye,I as _e,j as Se,r as d,u as Ce,a as e,o as Z}from"./index-DPDCU0Sd.js";import{z as Q,B as ee,S as se,j as ae,k as te,l as re,m as v,n as ie,o as ne,p as b,q as m,r as le,s as c,d as Te,e as De,f as He,g as Le,h as Ie,E as f,F as ce,A as oe,w as de,x as me}from"./xlsx-BwYBrUO5.js";import{B as x}from"./button-CxxTvLrF.js";import{I as xe}from"./input-Bet5STBL.js";import{b as B,C as he}from"./index-G-zrxCeu.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=ye("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Re=({onLogout:Ee})=>{const ue=_e(),{theme:pe}=Se(),[L,ge]=d.useState(""),[M,je]=d.useState([]),[V,O]=d.useState(!0),[k,_]=d.useState(1),[I,fe]=d.useState("10"),[F,we]=d.useState(1),[p,Ne]=d.useState(""),[P,G]=d.useState("asc"),[S,U]=d.useState(""),[j,q]=d.useState(""),[$,z]=d.useState("asc"),[g,w]=d.useState(1),[C,W]=d.useState(5),{toast:y}=Ce(),K=async(s,a,t)=>{try{O(!0);let r=`https://digio.pgn.co.id/lisa_backend/licenses/get?page=${s}&paginate=${a}&sortField=end_date&sortDirection=desc&name=`;t&&(r+=`${encodeURIComponent(t)}`);const n=await(await Z(r)).json();if(n.status===200){let N=n.data.docs;p&&(N=[...N].sort((l,H)=>{let o=l[p],u=H[p];return p==="harga_satuan"&&(o=Number(o),u=Number(u)),(p==="start_date"||p==="end_date")&&(o=new Date(o).getTime(),u=new Date(u).getTime()),P==="asc"?o<u?-1:o>u?1:0:o>u?-1:o<u?1:0})),je(N),we(n.data.pages)}else throw new Error("Gagal memuat data lisensi")}catch{y({title:"Error",description:"Terjadi kesalahan saat memuat data lisensi",variant:"destructive"})}finally{O(!1)}};d.useEffect(()=>{if(L){const s=setTimeout(()=>{K(1,parseInt(I),L),_(1)},500);return()=>clearTimeout(s)}else K(k,parseInt(I))},[k,I,p,P,L]);const h=s=>{const a={day:"2-digit",month:"long",year:"numeric"};return new Date(s).toLocaleDateString("id-ID",a)},R=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),ve=async()=>{try{const a=await(await Z("https://digio.pgn.co.id/lisa_backend/licenses/export")).json();if(a.status===200){const t=a.data.map((l,H)=>({No:H+1,"Nama Lisensi":l.name,Volume:l.volume,Satuan:l.satuan,"Harga Satuan":l.harga_satuan,"Total Harga":l.jumlah,"Tanggal Mulai":h(l.start_date),"Tanggal Berakhir":h(l.end_date),"Lokasi Lisensi":l.lokasi_lisensi,Deskripsi:l.description,"Terakhir Diubah Oleh":l.last_user_input})),r=[];a.data.forEach((l,H)=>{l.history_licenses&&l.history_licenses.length>0&&l.history_licenses.forEach((o,u)=>{r.push({No:`${H+1}.${u+1}`,"Nama Lisensi":l.name,"Harga Satuan (History)":o.harga_satuan,"Tanggal Record":h(o.tanggal),"Deskripsi (History)":o.description,"Terakhir Input Oleh":o.last_user_input,"Dibuat Pada":h(o.createdAt)})})});const i=f.book_new(),n=f.json_to_sheet(t);if(f.book_append_sheet(i,n,"Harga Lisensi"),r.length>0){const l=f.json_to_sheet(r);f.book_append_sheet(i,l,"Riwayat Harga")}const N=new Date().toISOString().split("T")[0];ce(i,`Harga_Lisensi_${N}.xlsx`),y({title:"Berhasil",description:"Data berhasil diekspor ke Excel dengan history",variant:"success"})}else y({title:"Info",description:"Tidak ada data yang bisa diekspor (data kosong)",variant:"warning"})}catch{y({title:"Error",description:"Gagal mengekspor data ke Excel",variant:"destructive"})}},E=s=>{p===s?G(P==="asc"?"desc":"asc"):(Ne(s),G("asc")),_(1)},A=s=>p!==s?e.jsx(oe,{className:"w-4 h-4 ml-1 opacity-50"}):P==="asc"?e.jsx(de,{className:"w-4 h-4 ml-1"}):e.jsx(me,{className:"w-4 h-4 ml-1"}),J=(s,a)=>{const t=[];t.push(1),s-2>2&&t.push("...");for(let i=Math.max(2,s-2);i<=Math.min(a-1,s+2);i++)t.push(i);return s+2<a-1&&t.push("..."),a>1&&t.push(a),t},T=s=>{j===s?z($==="asc"?"desc":"asc"):(q(s),z("asc")),w(1)},D=s=>j!==s?e.jsx(oe,{className:"w-4 h-4 ml-1 opacity-50"}):$==="asc"?e.jsx(de,{className:"w-4 h-4 ml-1"}):e.jsx(me,{className:"w-4 h-4 ml-1"}),be=s=>{let a=s;return S&&(a=s.filter(t=>t.description.toLowerCase().includes(S.toLowerCase())||t.last_user_input.toLowerCase().includes(S.toLowerCase())||R(t.harga_satuan).toLowerCase().includes(S.toLowerCase()))),j&&(a=[...a].sort((t,r)=>{let i=t[j],n=r[j];return j==="harga_satuan"&&(i=Number(i),n=Number(n)),(j==="tanggal"||j==="createdAt")&&(i=new Date(i).getTime(),n=new Date(n).getTime()),$==="asc"?i<n?-1:i>n?1:0:i>n?-1:i<n?1:0})),a},X=s=>{const a=be(s),t=(g-1)*C,r=t+C;return{items:a.slice(t,r),totalItems:a.length,totalPages:Math.ceil(a.length/C)}},ke=s=>{try{const a=s.history_licenses.map((n,N)=>({No:N+1,"Nama Lisensi":s.name,"Harga Satuan":n.harga_satuan,"Tanggal Record":h(n.tanggal),Deskripsi:n.description,"Terakhir Input Oleh":n.last_user_input,"Dibuat Pada":h(n.createdAt)})),t=f.book_new(),r=f.json_to_sheet(a);f.book_append_sheet(t,r,"Riwayat Harga");const i=new Date().toISOString().split("T")[0];ce(t,`History_${s.name}_${i}.xlsx`),y({title:"Berhasil",description:"History berhasil diekspor ke Excel",variant:"success"})}catch{y({title:"Error",description:"Gagal mengekspor history ke Excel",variant:"destructive"})}},Y=()=>{U(""),q(""),z("asc"),w(1),W(5)};return e.jsxs("div",{children:[e.jsx("header",{className:"bg-card border-b border-border shadow-sm",children:e.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("img",{src:pe==="dark"?"/lisa/logo-dark.png":"/lisa/logo-white.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain"}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Lisensi Aset"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Sistem Monitoring Lisensi Aset"})]})]}),e.jsxs(x,{variant:"default",onClick:()=>ue("/"),className:"flex items-center space-x-2",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Kembali"})]})]})})}),e.jsx("main",{className:"mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:e.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"Harga Lisensi"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Daftar harga dan informasi lisensi aset perusahaan"})]}),e.jsx("div",{className:"flex gap-2 w-full sm:w-auto",children:e.jsxs(x,{onClick:ve,variant:"success",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(Q,{className:"w-4 h-4"}),"Export Excel"]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsx("div",{children:e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-foreground",children:"Daftar Harga Lisensi"})})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm w-full md:w-auto",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(xe,{placeholder:"Cari lisensi...",value:L,onChange:s=>ge(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto justify-end",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Tampilkan:"}),e.jsxs(se,{value:I,onValueChange:fe,children:[e.jsx(ae,{className:"w-16",children:e.jsx(te,{})}),e.jsxs(re,{children:[e.jsx(v,{value:"10",children:"10"}),e.jsx(v,{value:"25",children:"25"}),e.jsx(v,{value:"50",children:"50"}),e.jsx(v,{value:"100",children:"100"})]})]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(ie,{className:"[&_tr>*]:border-r [&_tr>*:last-child]:border-r-0 [&_tr]:border-b [&_tr:last-child]:border-b-0",children:[e.jsx(ne,{children:e.jsxs(b,{className:"bg-muted/50 border-b",children:[e.jsx(m,{className:"w-[80px] whitespace-nowrap",children:"Aksi"}),e.jsx(m,{className:"w-[200px] whitespace-nowrap cursor-pointer hover:bg-muted/70",onClick:()=>E("name"),children:e.jsxs("div",{className:"flex items-center",children:["Nama Lisensi",A("name")]})}),e.jsx(m,{className:"w-[150px] whitespace-nowrap cursor-pointer hover:bg-muted/70",onClick:()=>E("harga_satuan"),children:e.jsxs("div",{className:"flex items-center",children:["Harga Satuan",A("harga_satuan")]})}),e.jsx(m,{className:"w-[150px] whitespace-nowrap cursor-pointer hover:bg-muted/70",onClick:()=>E("start_date"),children:e.jsxs("div",{className:"flex items-center",children:["Tanggal Mulai",A("start_date")]})}),e.jsx(m,{className:"w-[150px] whitespace-nowrap cursor-pointer hover:bg-muted/70",onClick:()=>E("end_date"),children:e.jsxs("div",{className:"flex items-center",children:["Tanggal Berakhir",A("end_date")]})}),e.jsx(m,{className:"w-[200px] whitespace-nowrap",children:"Catatan"})]})}),e.jsx(le,{className:"[&_tr:last-child]:border-b-0",children:V?e.jsx(b,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Memuat data..."})}):M.length===0?e.jsx(b,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"Tidak ada data harga lisensi yang ditemukan"})}):M.map(s=>e.jsxs(b,{className:"hover:bg-muted/30",children:[e.jsx(c,{className:"text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs(Te,{onOpenChange:a=>!a&&Y(),children:[e.jsx(De,{asChild:!0,children:e.jsx(x,{variant:"default",size:"sm",className:"h-8 w-8 p-0 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white border-0",disabled:!s.history_licenses||s.history_licenses.length===0,children:e.jsx(Pe,{className:"h-4 w-4"})})}),e.jsxs(He,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(Le,{className:"flex-shrink-0 flex flex-row items-center justify-between",children:[e.jsx("div",{children:e.jsxs(Ie,{className:"text-lg sm:text-xl",children:["History Harga - ",s.name]})}),e.jsxs(x,{onClick:()=>ke(s),variant:"success",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Export Excel"]})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col space-y-4",children:s.history_licenses&&s.history_licenses.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"relative w-full sm:max-w-md",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(xe,{placeholder:"Cari berdasarkan deskripsi atau pengguna...",value:S,onChange:a=>{U(a.target.value),w(1)},className:"pl-10 w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:"Tampilkan:"}),e.jsxs(se,{value:C.toString(),onValueChange:a=>{W(parseInt(a)),w(1)},children:[e.jsx(ae,{className:"w-full sm:w-16",children:e.jsx(te,{})}),e.jsxs(re,{children:[e.jsx(v,{value:"5",children:"5"}),e.jsx(v,{value:"10",children:"10"}),e.jsx(v,{value:"25",children:"25"})]})]})]})]}),e.jsx("div",{className:"flex-1 border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto overflow-y-auto max-h-96",children:e.jsxs(ie,{className:"[&_tr>*]:border-r [&_tr>*:last-child]:border-r-0 [&_tr]:border-b [&_tr:last-child]:border-b-0",children:[e.jsx(ne,{className:"sticky top-0 bg-background",children:e.jsxs(b,{className:"bg-muted/50 border-b",children:[e.jsx(m,{className:"w-[50px] text-center",children:"No"}),e.jsx(m,{className:"w-[130px] cursor-pointer hover:bg-muted/70 whitespace-nowrap",onClick:()=>T("harga_satuan"),children:e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:["Harga Satuan",D("harga_satuan")]})}),e.jsx(m,{className:"w-[110px] cursor-pointer hover:bg-muted/70 whitespace-nowrap",onClick:()=>T("tanggal"),children:e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:["Tanggal",D("tanggal")]})}),e.jsx(m,{className:"w-[180px] cursor-pointer hover:bg-muted/70",onClick:()=>T("description"),children:e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:["Deskripsi",D("description")]})}),e.jsx(m,{className:"w-[130px] cursor-pointer hover:bg-muted/70 whitespace-nowrap",onClick:()=>T("last_user_input"),children:e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:["Input Oleh",D("last_user_input")]})}),e.jsx(m,{className:"w-[110px] cursor-pointer hover:bg-muted/70 whitespace-nowrap",onClick:()=>T("createdAt"),children:e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:["Dibuat",D("createdAt")]})})]})}),e.jsx(le,{children:(()=>{const{items:a,totalItems:t}=X(s.history_licenses);return a.length>0?a.map((r,i)=>e.jsxs(b,{className:"hover:bg-muted/30",children:[e.jsx(c,{className:"text-center text-xs sm:text-sm",children:(g-1)*C+i+1}),e.jsx(c,{className:"text-right whitespace-nowrap text-xs sm:text-sm",children:R(r.harga_satuan)}),e.jsx(c,{className:"whitespace-nowrap text-xs sm:text-sm",children:h(r.tanggal)}),e.jsx(c,{className:"max-w-[150px] sm:max-w-xs",children:e.jsx("div",{className:"truncate text-xs sm:text-sm",title:r.description,children:r.description})}),e.jsx(c,{className:"text-xs sm:text-sm",children:r.last_user_input}),e.jsx(c,{className:"whitespace-nowrap text-xs sm:text-sm",children:h(r.createdAt)})]},r.uuid)):e.jsx(b,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"Tidak ada riwayat yang ditemukan"})})})()})]})})}),(()=>{const{totalPages:a}=X(s.history_licenses);return a>1&&e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>w(Math.max(1,g-1)),disabled:g===1,children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:"Previous"})]}),e.jsx("div",{className:"flex items-center gap-1",children:J(g,a).map((t,r)=>e.jsx(x,{variant:t===g?"default":"outline",size:"sm",className:"w-8 h-8 p-0",onClick:()=>typeof t=="number"&&w(t),disabled:typeof t!="number",children:t},r))}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>w(Math.min(a,g+1)),disabled:g===a,children:[e.jsx("span",{className:"hidden sm:inline mr-1",children:"Next"}),e.jsx(he,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground",children:["Halaman ",g," dari ",a]})]})})()]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Tidak ada riwayat harga untuk lisensi ini"})}),e.jsx("div",{className:"flex-shrink-0 flex justify-end pt-4 border-t",children:e.jsx(x,{variant:"destructive",onClick:()=>Y(),children:"Tutup"})})]})]})})}),e.jsx(c,{className:"font-medium",children:s.name}),e.jsx(c,{className:"text-right whitespace-nowrap",children:R(s.harga_satuan)}),e.jsx(c,{className:"whitespace-nowrap",children:h(s.start_date)}),e.jsx(c,{className:"whitespace-nowrap",children:h(s.end_date)}),e.jsx(c,{className:"max-w-xs",children:e.jsx("div",{className:"truncate",title:s.description,children:s.description})})]},s.uuid))})]})}),!V&&M.length>0&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>_(s=>Math.max(1,s-1)),disabled:k===1,children:e.jsx(B,{className:"w-4 h-4"})}),J(k,F).map((s,a)=>e.jsx(x,{variant:k===s?"default":"outline",size:"sm",onClick:()=>typeof s=="number"&&_(s),disabled:s==="...",children:s},a)),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>_(s=>Math.min(F,s+1)),disabled:k===F,children:e.jsx(he,{className:"w-4 h-4"})})]})]})]})})]})};export{Re as default};
