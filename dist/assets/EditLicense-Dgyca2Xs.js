import{a6 as q,W as G,u as z,j as J,r as u,a as e,B as x,L as l,I as h,k as N,U as _,e as k,a3 as W,a2 as X,a4 as Q}from"./index-ByCW27ks.js";import{P as y,a as f,C,f as S,b as E,c as I,T as Y}from"./popover-Bbned-nQ.js";import{C as Z}from"./chevron-left-hrojxHCq.js";import{E as D,a as ee}from"./eye-BxdyZp2k.js";import{C as se}from"./circle-check-CumgCNDF.js";const ae=c=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(c),F=c=>{const o=c.replace(/\D/g,"");return o?`Rp. ${new Intl.NumberFormat("id-ID").format(parseInt(o))}`:""},te=c=>{const o=c.replace(/Rp\.\s?/g,"").replace(/\./g,"");return parseInt(o)||0},ce=()=>{const{uuid:c}=q(),o=G(),{toast:p}=z(),{theme:L}=J(),[M,T]=u.useState(!0),[s,j]=u.useState(null),[t,v]=u.useState({}),[P,b]=u.useState(""),[g,A]=u.useState(!1),[R,B]=u.useState(!1);u.useEffect(()=>{B(window.self!==window.top)},[]),u.useEffect(()=>{c&&(async()=>{try{const r=await(await _(`${k}/licenses/find?uuid=${c}`)).json();if(r.status===200&&r.data){const{history_licenses:i,...m}=r.data;j(m),m.harga_satuan&&b(F(m.harga_satuan.toString()))}else throw new Error("Gagal memuat data lisensi")}catch{p({title:"Error",description:"Terjadi kesalahan saat memuat data lisensi",variant:"destructive"}),o("/")}finally{T(!1)}})()},[c]);const O=()=>{const a={};if(["name","start_date","end_date","volume","satuan","harga_satuan","username","password"].forEach(r=>{s!=null&&s[r]||(a[r]="Field ini wajib diisi")}),s!=null&&s.volume&&s.volume<=0&&(a.volume="Volume harus lebih besar dari 0"),s!=null&&s.harga_satuan&&s.harga_satuan<0&&(a.harga_satuan="Harga satuan tidak boleh negatif"),s!=null&&s.start_date&&(s!=null&&s.end_date)){const r=new Date(s.start_date),i=new Date(s.end_date);r>i&&(a.start_date="Tanggal mulai tidak boleh lebih besar dari tanggal berakhir",a.end_date="Tanggal berakhir tidak boleh lebih kecil dari tanggal mulai")}return v(a),Object.keys(a).length===0},d=(a,n)=>{if(!s)return;const r={...s,[a]:n};if(a==="volume"||a==="harga_satuan"){const i=a==="volume"?Number(n):s.volume,m=a==="harga_satuan"?Number(n):s.harga_satuan;r.jumlah=i*m}if(a==="start_date"||a==="end_date"){const i={...t},m=a==="start_date"?n:s.start_date,w=a==="end_date"?n:s.end_date;if(m&&w){const U=new Date(m),H=new Date(w);U>H?(i.start_date="Tanggal mulai tidak boleh lebih besar dari tanggal berakhir",i.end_date="Tanggal berakhir tidak boleh lebih kecil dari tanggal mulai"):(delete i.start_date,delete i.end_date)}else delete i.start_date,delete i.end_date;v(i)}j(r)},$=a=>{const n=F(a);b(n);const r=te(n);d("harga_satuan",r)},K=a=>a===1?{text:"Sudah Kadaluarsa",color:"bg-red-100 text-red-700 border-red-200",icon:W}:a===2?{text:"Akan Kadaluarsa",color:"bg-yellow-100 text-yellow-700 border-yellow-200",icon:X}:{text:"Aman",color:"bg-green-100 text-green-700 border-green-200",icon:se},V=async a=>{if(a.preventDefault(),!!O())try{const n=Q("auth_name")||"",r={...s,last_user_input:n,updatedAt:new Date().toISOString()};if((await _(`${k}/licenses/update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)p({title:"Berhasil",description:"Data lisensi berhasil diperbarui",variant:"success"}),o("/");else throw new Error("Gagal memperbarui data")}catch{p({title:"Error",description:"Terjadi kesalahan saat memperbarui data lisensi",variant:"destructive"})}};return M?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Memuat..."}):e.jsxs("div",{children:[e.jsx("header",{className:"bg-card border-b border-border shadow-sm",children:e.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("img",{src:L==="dark"?"/lisa/logo-dark.png":"/lisa/logo-white.png",alt:"Lisensi Aset Logo",className:"h-8 w-auto sm:h-8 object-contain"}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Lisensi Aset"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Sistem Monitoring Lisensi Aset"})]})]}),!R&&e.jsxs(x,{variant:"default",onClick:()=>o("/"),className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Kembali"})]})]})})}),e.jsx("main",{className:"mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:e.jsx("div",{className:"space-y-6 sm:space-y-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2",children:"Edit Lisensi"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Edit data lisensi yang sudah ada"})]}),(s==null?void 0:s.end_date)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),(()=>{const a=K(s.status_lisensi),n=a.icon;return e.jsxs("div",{className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium border ${a.color}`,children:[e.jsx(n,{className:"w-4 h-4 mr-1.5"}),a.text]})})()]})]})})}),e.jsx("div",{className:"mx-auto px-4 sm:px-6 lg:px-8 pb-8",children:e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsx("div",{className:"bg-card p-4 sm:p-6 rounded-lg border border-border",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(l,{htmlFor:"name",children:"Nama Aset"}),e.jsx(h,{id:"name",value:(s==null?void 0:s.name)||"",onChange:a=>d("name",a.target.value),"aria-invalid":!!t.name,className:"mt-1",placeholder:"Masukkan nama aset"}),t.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.name})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Tanggal Mulai"}),e.jsxs(y,{children:[e.jsx(f,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:N("w-full justify-start text-left font-normal mt-1",!(s!=null&&s.start_date)&&"text-muted-foreground"),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),s!=null&&s.start_date?S(new Date(s.start_date),"yyyy-MM-dd"):e.jsx("span",{children:"Pilih tanggal"})]})}),e.jsx(E,{className:"w-auto p-0",children:e.jsx(I,{mode:"single",selected:s!=null&&s.start_date?new Date(s.start_date):void 0,onSelect:a=>{d("start_date",(a==null?void 0:a.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.start_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.start_date})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Tanggal Berakhir"}),e.jsxs(y,{children:[e.jsx(f,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:N("w-full justify-start text-left font-normal mt-1",!(s!=null&&s.end_date)&&"text-muted-foreground"),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),s!=null&&s.end_date?S(new Date(s.end_date),"yyyy-MM-dd"):e.jsx("span",{children:"Pilih tanggal"})]})}),e.jsx(E,{className:"w-auto p-0",children:e.jsx(I,{mode:"single",selected:s!=null&&s.end_date?new Date(s.end_date):void 0,onSelect:a=>{d("end_date",(a==null?void 0:a.toISOString())||""),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))},className:"pointer-events-auto"})})]}),t.end_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.end_date})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"volume",children:"Volume"}),e.jsx(h,{id:"volume",type:"number",value:(s==null?void 0:s.volume)||"",onChange:a=>d("volume",Number(a.target.value)),"aria-invalid":!!t.volume,className:"mt-1",placeholder:"Masukkan volume"}),t.volume&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.volume})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"satuan",children:"Satuan"}),e.jsx(h,{id:"satuan",value:(s==null?void 0:s.satuan)||"",onChange:a=>d("satuan",a.target.value),"aria-invalid":!!t.satuan,className:"mt-1",placeholder:"Masukkan satuan"}),t.satuan&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.satuan})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"harga_satuan",children:"Harga Satuan"}),e.jsx(h,{id:"harga_satuan",type:"text",value:P,onChange:a=>$(a.target.value),"aria-invalid":!!t.harga_satuan,className:"mt-1",placeholder:"Masukkan harga satuan"}),t.harga_satuan&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.harga_satuan})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"jumlah",children:"Total Harga"}),e.jsx(h,{id:"jumlah",type:"text",value:s!=null&&s.jumlah?ae(s.jumlah):"Rp 0",disabled:!0,className:"mt-1 bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"username",children:"Username"}),e.jsx(h,{id:"username",value:(s==null?void 0:s.username)||"",onChange:a=>d("username",a.target.value),"aria-invalid":!!t.username,className:"mt-1",placeholder:"Masukkan username"}),t.username&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.username})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"password",type:g?"text":"password",value:(s==null?void 0:s.password)||"",onChange:a=>d("password",a.target.value),"aria-invalid":!!t.password,className:"mt-1 pr-10",placeholder:"Masukkan password"}),e.jsx(x,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>A(!g),children:g?e.jsx(D,{className:"w-4 h-4"}):e.jsx(ee,{className:"w-4 h-4"})})]}),t.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.password})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"lokasi_lisensi",children:"Lokasi"}),e.jsx(h,{id:"lokasi_lisensi",value:(s==null?void 0:s.lokasi_lisensi)||"",onChange:a=>d("lokasi_lisensi",a.target.value),className:"mt-1",placeholder:"Masukkan lokasi"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",children:"Catatan"}),e.jsx(Y,{id:"description",value:(s==null?void 0:s.description)||"",onChange:a=>d("description",a.target.value),className:"mt-1",rows:4,placeholder:"Masukkan catatan atau keterangan tambahan..."})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:[e.jsx(x,{type:"button",variant:"destructive",onClick:()=>o("/"),className:"w-full sm:w-auto order-2 sm:order-1",children:"Batal"}),e.jsx(x,{type:"submit",className:"w-full sm:w-auto order-1 sm:order-2",children:"Simpan"})]})]})})]})};export{ce as EditLicense};
